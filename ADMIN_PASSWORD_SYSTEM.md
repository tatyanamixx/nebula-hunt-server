# –°–∏—Å—Ç–µ–º–∞ –ø–∞—Ä–æ–ª–µ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–∞—Ä–æ–ª–µ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —á–µ—Ä–µ–∑ email –∏ –ø–∞—Ä–æ–ª—å —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

-   –í—Ö–æ–¥ —á–µ—Ä–µ–∑ email –∏ –ø–∞—Ä–æ–ª—å
-   –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º bcrypt
-   –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
-   –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
-   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞

### ‚è∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è

-   –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø–∞—Ä–æ–ª–µ–π
-   –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Å–∫–æ—Ä–æ–º –∏—Å—Ç–µ—á–µ–Ω–∏–∏
-   –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –ø–∞—Ä–æ–ª–µ–π

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

-   –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ—Å–ª–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ –ø–æ–ø—ã—Ç–æ–∫
-   –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º
-   –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–∞—Ä–æ–ª—è–º–∏

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –ü–∞—Ä–æ–ª—å —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä–∞ (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)
SUPERVISOR_PASSWORD=your_secure_supervisor_password

# –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø–∞—Ä–æ–ª—è –≤ –¥–Ω—è—Ö (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –ø–∞—Ä–æ–ª–∏ –Ω–µ –∏—Å—Ç–µ–∫–∞—é—Ç)
ADMIN_PASSWORD_EXPIRY_DAYS=90

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
ADMIN_MAX_LOGIN_ATTEMPTS=5

# –í—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö –ø–æ—Å–ª–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ –ø–æ–ø—ã—Ç–æ–∫
ADMIN_LOCKOUT_DURATION_MINUTES=30

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è
ADMIN_MIN_PASSWORD_LENGTH=8
```

## API Endpoints

### –í—Ö–æ–¥ —á–µ—Ä–µ–∑ –ø–∞—Ä–æ–ª—å

```http
POST /api/admin/login/password
Content-Type: application/json

{
  "email": "admin@example.com",
  "password": "SecurePassword123!"
}
```

**–û—Ç–≤–µ—Ç:**

```json
{
	"message": "Admin login successful",
	"email": "admin@example.com",
	"id": 1,
	"name": "Admin Name",
	"role": "ADMIN",
	"provider": "password",
	"accessToken": "jwt_token_here",
	"refreshToken": "refresh_token_here",
	"passwordWarning": false,
	"passwordDaysLeft": null,
	"passwordMessage": null
}
```

### –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

```http
POST /api/admin/password/change
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "currentPassword": "OldPassword123!",
  "newPassword": "NewSecurePassword456!"
}
```

### –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä–∞)

```http
POST /api/admin/password/force-change
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "adminId": 2,
  "newPassword": "NewSecurePassword456!"
}
```

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞—Ä–æ–ª–µ

```http
GET /api/admin/password/info
Authorization: Bearer <access_token>
```

**–û—Ç–≤–µ—Ç:**

```json
{
	"hasPassword": true,
	"passwordChangedAt": "2025-07-26T10:00:00.000Z",
	"passwordExpiresAt": "2025-10-24T10:00:00.000Z",
	"lastLoginAt": "2025-07-26T12:00:00.000Z",
	"loginAttempts": 0,
	"lockedUntil": null,
	"passwordWarning": false,
	"passwordDaysLeft": 89,
	"passwordMessage": null,
	"isLocked": false,
	"lockMinutesLeft": null
}
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—è–º

–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:

-   –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ADMIN_MIN_PASSWORD_LENGTH`)
-   –°–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ü–∏—Ñ—Ä—É
-   –°–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –±—É–∫–≤—É
-   –°–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–µ—Ä–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä–∞

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∏—Å—Ç–µ–º—ã —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –ø–∞—Ä–æ–ª–µ–º –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `SUPERVISOR_PASSWORD`.

### 2. –û–±—ã—á–Ω—ã–π –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤–≤–æ–¥–∏—Ç email –∏ –ø–∞—Ä–æ–ª—å
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è JWT —Ç–æ–∫–µ–Ω—ã
4. –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å —Å–∫–æ—Ä–æ –∏—Å—Ç–µ—á–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

### 3. –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—É—â–∏–π –∏ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
2. –°–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
3. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Å–º–µ–Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è

### 4. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞

1. –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∞–∫–∫–∞—É–Ω—Ç –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
2. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–Ω–∏–º–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
3. –°—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

-   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è bcrypt —Å 12 —Ä–∞—É–Ω–¥–∞–º–∏ —Å–æ–ª–∏
-   –ü–∞—Ä–æ–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ

### –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞

-   –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
-   –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞
-   Rate limiting –Ω–∞ API endpoints

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

-   –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–∞—Ä–æ–ª—è–º–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
-   –û—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
-   –õ–æ–≥–∏—Ä—É—é—Ç—Å—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª–µ–π

## –ú–∏–≥—Ä–∞—Ü–∏—è

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü—É admin –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
npm run migrate
```

–≠—Ç–æ –¥–æ–±–∞–≤–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:

-   `passwordChangedAt` - –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
-   `passwordExpiresAt` - –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
-   `lastLoginAt` - –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
-   `loginAttempts` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
-   `lockedUntil` - –≤—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –ø–∞—Ä–æ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
# –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –ø–∞—Ä–æ–ª–µ–π
npm run test:integration:service -- --testNamePattern="password"

# –¢–µ—Å—Ç—ã API –ø–∞—Ä–æ–ª–µ–π
npm run test:integration:api -- --testNamePattern="password"
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å –ø–∞—Ä–æ–ª–µ–º

```javascript
const adminService = require('./service/admin-service');
const passwordService = require('./service/password-service');

// –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∞
const admin = await Admin.create({
	email: 'admin@example.com',
	name: 'Admin User',
	role: 'ADMIN',
});

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–æ–ª—è
await passwordService.setPasswordWithExpiry(admin, 'SecurePassword123!');
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–∞—Ä–æ–ª—è

```javascript
const passwordCheck = passwordService.checkPasswordChangeRequired(admin);

if (passwordCheck.changeRequired) {
	console.log('–ü–∞—Ä–æ–ª—å –∏—Å—Ç–µ–∫, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–º–µ–Ω–∞');
} else if (passwordCheck.warning) {
	console.log(`–ü–∞—Ä–æ–ª—å –∏—Å—Ç–µ—á–µ—Ç —á–µ—Ä–µ–∑ ${passwordCheck.daysLeft} –¥–Ω–µ–π`);
}
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Account is locked"

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–∂–¥–∏—Ç–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å—É–ø–µ—Ä–≤–∏–∑–æ—Ä—É –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

### –ü—Ä–æ–±–ª–µ–º–∞: "Password expired"

**–†–µ—à–µ–Ω–∏–µ:** –°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ API `/api/admin/password/change`.

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid password format"

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ä–æ–ª—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

-   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
-   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
-   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Ç–µ–∫—à–∏—Ö –ø–∞—Ä–æ–ª–µ–π
-   –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API –ø–∞—Ä–æ–ª–µ–π
