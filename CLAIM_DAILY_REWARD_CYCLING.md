# ClaimDailyReward Cycling Logic

## Описание изменений

Метод `claimDailyReward` в `service/game-service.js` был модифицирован для поддержки циклической логики наград.

## Как это работает

### Старая логика

-   Награды выдавались только если `currentStreak` находился в массиве `condition.days`
-   После достижения максимального дня в массиве, награды больше не выдавались

### Новая логика

-   Награды выдаются циклически после достижения максимального дня
-   `effectiveStreak = ((currentStreak - 1) % maxDay) + 1`
-   Цикл повторяется каждые `maxDay` дней

## Примеры

### Пример 1: days = [1, 2, 3, 4, 5, 6, 7]

-   Максимальный день: 7
-   Цикл: 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, ...
-   Награды выдаются каждый день

### Пример 2: days = [3, 15]

-   Максимальный день: 15
-   Цикл: 3, 15, 3, 15, 3, 15, ...
-   Награды выдаются на 3-й и 15-й день каждого цикла

### Пример 3: days = [1, 5, 10]

-   Максимальный день: 10
-   Цикл: 1, 5, 10, 1, 5, 10, 1, 5, 10, ...
-   Награды выдаются на 1-й, 5-й и 10-й день каждого цикла

## Изменения в коде

```javascript
// Старый код
if (condition.days && condition.days.includes(currentStreak)) {
	// Выдаем награду
}

// Новый код
if (condition.days && condition.days.length > 0) {
	const maxDay = Math.max(...condition.days);

	let effectiveStreak = currentStreak;
	if (currentStreak > maxDay) {
		const cyclePosition = ((currentStreak - 1) % maxDay) + 1;
		effectiveStreak = cyclePosition;
	}

	if (condition.days.includes(effectiveStreak)) {
		// Выдаем награду с effectiveStreak
	}
}
```

## Тестирование

Созданы тесты для проверки новой логики:

-   `test-cycling-logic-demo.js` - демонстрация логики
-   `test-claim-daily-reward-cycling.js` - полный тест с базой данных

## Преимущества

1. **Бесконечные награды**: Пользователи могут получать награды бесконечно
2. **Гибкость**: Можно настроить любые дни для наград
3. **Предсказуемость**: Цикл повторяется регулярно
4. **Обратная совместимость**: Старые конфигурации работают как прежде
