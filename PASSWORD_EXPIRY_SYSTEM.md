# üîê –°–∏—Å—Ç–µ–º–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª–µ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

## üìã –û–±–∑–æ—Ä

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º –ø–∞—Ä–æ–ª–µ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —Å –æ–ø–æ–≤–µ—â–µ–Ω–∏—è–º–∏ –∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–º–µ–Ω–æ–π –ø–∞—Ä–æ–ª—è.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### üîî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

1. **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 5 –¥–Ω–µ–π** - Email —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –æ —Å–∫–æ—Ä–æ–º –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è
2. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞** - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
3. **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ 9:00 —É—Ç—Ä–∞ –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

-   –ü–∞—Ä–æ–ª–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 90 –¥–Ω–µ–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
-   –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
-   –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è (24 —á–∞—Å–∞)
-   Rate limiting –Ω–∞ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
npm run migrate
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–æ–ª–µ–π
ADMIN_PASSWORD_EXPIRY_DAYS=90
ADMIN_MIN_PASSWORD_LENGTH=8

# Email –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASS=your_app_password
SMTP_FROM=noreply@nebulahunt.com
FRONTEND_URL=http://localhost:3000
```

### 3. –ó–∞–ø—É—Å–∫ cron job

Cron job –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ production —Ä–µ–∂–∏–º–µ:

```javascript
// –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 —É—Ç—Ä–∞
'0 9 * * *';
```

## üìß Email —à–∞–±–ª–æ–Ω—ã

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏

-   **–®–∞–±–ª–æ–Ω**: `templates/password-expiry-warning.html`
-   **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è**: –ó–∞ 5 –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
-   **–°–æ–¥–µ—Ä–∂–∏—Ç**: –°—Å—ã–ª–∫—É –Ω–∞ —Å–º–µ–Ω—É –ø–∞—Ä–æ–ª—è, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

-   **–®–∞–±–ª–æ–Ω**: `templates/forced-password-change.html`
-   **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è**: –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è
-   **–°–æ–¥–µ—Ä–∂–∏—Ç**: –°—Å—ã–ª–∫—É –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –Ω–æ–≤–æ–º—É –ø–∞—Ä–æ–ª—é

## üîß API Endpoints

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ —Å–±—Ä–æ—Å–∞

```http
GET /api/admin/password-reset/validate/:token
```

**–û—Ç–≤–µ—Ç:**

```json
{
	"success": true,
	"message": "Token is valid",
	"data": {
		"adminId": 1,
		"email": "admin@example.com",
		"name": "Admin Name"
	}
}
```

### –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è

```http
POST /api/admin/password-reset/reset
Content-Type: application/json

{
  "token": "reset_token_here",
  "newPassword": "new_password123",
  "confirmPassword": "new_password123"
}
```

**–û—Ç–≤–µ—Ç:**

```json
{
	"success": true,
	"message": "Password reset successful",
	"data": {
		"temporaryToken": "temp_token_here",
		"expiresIn": "1 hour"
	}
}
```

### –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```http
POST /api/admin/password-reset/resend
Content-Type: application/json

{
  "email": "admin@example.com"
}
```

### –°—Ç–∞—Ç—É—Å –ø–∞—Ä–æ–ª—è

```http
GET /api/admin/password-reset/status/:adminId
```

**–û—Ç–≤–µ—Ç:**

```json
{
	"success": true,
	"data": {
		"isLocked": false,
		"passwordExpiresAt": "2024-12-31T23:59:59.000Z",
		"daysUntilExpiry": 45,
		"isExpired": false,
		"passwordExpiryNotified": false
	}
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
node test-password-expiry-system.js test

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
node test-password-expiry-system.js notifications

# –°–±—Ä–æ—Å —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
node test-password-expiry-system.js reset
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä—É—á–Ω—É—é
const { runManualCheck } = require('./jobs/password-expiry-checker');
await runManualCheck();
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```javascript
// –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤
logger.info('Starting password expiry check...');
logger.info('Expiry warning sent to admin admin@example.com');
logger.info(
	'Forced password change notification sent to admin admin@example.com'
);
logger.info('Password reset successful for admin 1');
```

### –ú–µ—Ç—Ä–∏–∫–∏

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

-   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–¥–º–∏–Ω–æ–≤ —Å –∏—Å—Ç–µ–∫–∞—é—â–∏–º–∏ –ø–∞—Ä–æ–ª—è–º–∏
-   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
-   –£—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É—Å–ø–µ—à–Ω—ã–µ —Å–±—Ä–æ—Å—ã –ø–∞—Ä–æ–ª–µ–π

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### 1. –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (9:00)

```mermaid
graph TD
    A[–ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏] --> B[–ü–æ–∏—Å–∫ –∞–¥–º–∏–Ω–æ–≤ —Å –∏—Å—Ç–µ–∫–∞—é—â–∏–º–∏ –ø–∞—Ä–æ–ª—è–º–∏]
    B --> C{–ü–∞—Ä–æ–ª—å –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 5 –¥–Ω–µ–π?}
    C -->|–î–∞| D[–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è]
    C -->|–ù–µ—Ç| E{–ü–∞—Ä–æ–ª—å —É–∂–µ –∏—Å—Ç–µ–∫?}
    E -->|–î–∞| F[–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ + –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è]
    E -->|–ù–µ—Ç| G[–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ]
    D --> G
    F --> G
```

### 2. –ü—Ä–æ—Ü–µ—Å—Å —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è

```mermaid
graph TD
    A[–ê–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç email] --> B[–ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ]
    B --> C[–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞]
    C --> D[–í–≤–æ–¥ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è]
    D --> E[–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π]
    E --> F[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è]
    F --> G[–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞]
    G --> H[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞]
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é

-   –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
-   –ë—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã
-   –ù–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –ø–∞—Ä–æ–ª—è–º–∏

### Rate Limiting

-   –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞: 5 –ø–æ–ø—ã—Ç–æ–∫ –∑–∞ 5 –º–∏–Ω—É—Ç
-   –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è: 3 –ø–æ–ø—ã—Ç–∫–∏ –∑–∞ 10 –º–∏–Ω—É—Ç
-   –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞: 2 –ø–æ–ø—ã—Ç–∫–∏ –∑–∞ 15 –º–∏–Ω—É—Ç

### –¢–æ–∫–µ–Ω—ã

-   **–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è**: 24 —á–∞—Å–∞
-   **–í—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø**: 1 —á–∞—Å
-   **JWT –ø–æ–¥–ø–∏—Å—å**: JWT_ACCESS_SECRET

## üêõ Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Email –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è**

    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ FRONTEND_URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

2. **Cron job –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**

    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ NODE_ENV (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å production)
    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

3. **–¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω**
    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è (—Ç–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 24 —á–∞—Å–∞)
    - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ JWT_ACCESS_SECRET –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f logs/app.log | grep "password"

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep "ERROR.*password" logs/app.log
```

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è                   | –û–ø–∏—Å–∞–Ω–∏–µ                    | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| ---------------------------- | --------------------------- | ------------ |
| `ADMIN_PASSWORD_EXPIRY_DAYS` | –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø–∞—Ä–æ–ª—è –≤ –¥–Ω—è—Ö | 90           |
| `ADMIN_MIN_PASSWORD_LENGTH`  | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è    | 8            |
| `SMTP_HOST`                  | SMTP —Å–µ—Ä–≤–µ—Ä                 | -            |
| `SMTP_PORT`                  | SMTP –ø–æ—Ä—Ç                   | 587          |
| `SMTP_USER`                  | SMTP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å           | -            |
| `SMTP_PASS`                  | SMTP –ø–∞—Ä–æ–ª—å                 | -            |
| `FRONTEND_URL`               | URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞               | -            |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

–ò–∑–º–µ–Ω–∏—Ç–µ cron –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ `jobs/password-expiry-checker.js`:

```javascript
// –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 —É—Ç—Ä–∞
'0 9 * * *';

// –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 6:00 —É—Ç—Ä–∞
'0 6 * * *';

// –ö–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤
'0 */12 * * *';
```

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

-   `service/password-expiry-service.js` - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
-   `controllers/password-reset-controller.js` - API –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
-   `routes/password-reset-router.js` - API —Ä–æ—É—Ç—ã
-   `jobs/password-expiry-checker.js` - Cron job
-   `utils/token-utils.js` - –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
-   `templates/` - Email —à–∞–±–ª–æ–Ω—ã
-   `migrations/20250101000012-add-password-expiry-fields.js` - –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
